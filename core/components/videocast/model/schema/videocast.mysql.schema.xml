<?xml version="1.0" encoding="UTF-8" ?>

<model package="videocast" baseClass="xPDOObject" platform="mysql"
       defaultEngine="MyISAM" phpdoc-package="videocast" version="1.1">

    <object class="vcCollection" table="vc_collections" extends="xPDOSimpleObject">

        <field key="title" phptype="string" comment="Short name of collection"
               dbtype="varchar" precision="255" null="false" default="" />

        <field key="alias" phptype="string" comment="Slugged title for link of collection"
               dbtype="varchar" precision="255" null="false" default="" index="index" />

        <field key="description" phptype="string" comment="Description or introduction of collection"
               dbtype="text"  null="true" default="" />

        <field key="cover" phptype="string" comment="Path to image, that will be used as cover"
               dbtype="varchar" precision="255" null="false" default="" />

        <field key="rank" phptype="integer" comment="Order of categories in lists"
               dbtype="integer" precision="10" null="false" default="0" index="index"/>

        <field key="hidden" phptype="boolean" comment="Collection, that exists but hidden from lists and search"
               dbtype="tinyint" precision="1" attributes="unsigned" null="true" default="0" index="index" />

        <field key="publishedon" phptype="timestamp" comment="Date of publishing video"
               dbtype="timestamp" null="false" default="CURRENT_TIMESTAMP" index="index"/>

        <validation>

            <rule field="title" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_collections_title_err_notEmpty"/>
            <rule field="title" name="onlyAlphaNum" type="preg_match" rule="/^[a-zA-Zа-яА-Я0-9_\-\s]*$/" message="vc_collections_title_err_onlyAlphaNum"/>

            <rule field="alias" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_collections_alias_err_notEmpty"/>
            <rule field="alias" name="onlyAlphaNum" type="preg_match" rule="/^[a-zA-Z0-9_]*$/" value="1" message="vc_collections_alias_err_notEmpty"/>

            <rule field="description" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_collections_description_err_notEmpty"/>

            <rule field="cover" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_collections_cover_err_notEmpty"/>

        </validation>

        <index alias="alias" name="alias" primary="false" unique="false" type="BTREE">
            <column key="alias" length="" collation="A" null="false" />
        </index>

        <index alias="rank" name="rank" primary="false" unique="false" type="BTREE">
            <column key="rank" length="" collation="A" null="false" />
        </index>

        <index alias="hidden" name="hidden" primary="false" unique="false" type="BTREE">
            <column key="hidden" length="" collation="A" null="false" />
        </index>

        <composite alias="Videos" class="vcVideo" local="id" foreign="collection" cardinality="many" owner="local" />

    </object>

    <object class="vcCourse" table="vc_courses" extends="xPDOSimpleObject">

        <field key="title" phptype="string" comment="Short name of course"
               dbtype="varchar" precision="255" null="false" default="" />

        <field key="alias" phptype="string" comment="Slugged title for link of course"
               dbtype="varchar" precision="255" null="false" default="" index="index" />

        <field key="description" phptype="string" comment="Description or introduction of course"
               dbtype="text"  null="true" default="" />

        <field key="cover" phptype="string" comment="Path to image, that will be used as cover"
               dbtype="varchar" precision="255" null="false" default="" />

        <field key="complexity" phptype="string" comment="Complexity of course (youngling | padawan | knight | master)"
               dbtype="varchar" precision="50" null="true" default="" index="index" />

        <index alias="alias" name="alias" primary="false" unique="false" type="BTREE">
            <column key="alias" length="" collation="A" null="false" />
        </index>

        <index alias="complexity" name="complexity" primary="false" unique="false" type="BTREE">
            <column key="complexity" length="" collation="A" null="false" />
        </index>

        <composite alias="Collections" class="vcCourseCollection" local="id" foreign="course" cardinality="many" owner="local" />
        <composite alias="Videos" class="vcCourseVideo" local="id" foreign="course" cardinality="many" owner="local" />

    </object>

    <object class="vcCourseCollection" table="vc_courses_collections" extends="xPDOObject">

        <field  key="course" phptype="integer" comment="Link to course"
                dbtype="integer" precision="10" attributes="unsigned" null="false" default="0" index="pk"/>

        <field  key="collection" phptype="integer" comment="Link to collection"
                dbtype="int" precision="10" attributes="unsigned" null="false" default="0" index="pk"/>

        <field key="rank" phptype="integer" comment="Order of elements in lists"
               dbtype="integer" precision="10" null="false" default="0" index="index"/>

        <index alias="PRIMARY" name="PRIMARY" primary="true" unique="true" type="BTREE">
            <column key="course" length="" collation="A" null="false" />
            <column key="collection" length="" collation="A" null="false" />
        </index>

        <index alias="rank" name="rank" primary="false" unique="false" type="BTREE">
            <column key="rank" length="" collation="A" null="false" />
        </index>

        <aggregate alias="Course" class="vcCourse" local="course" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Collection" class="vcCollection" local="collection" foreign="id" cardinality="one" owner="foreign" />

    </object>

    <object class="vcCourseVideo" table="vc_courses_videos" extends="xPDOObject">

        <field  key="course" phptype="integer" comment="Link to course"
                dbtype="integer" precision="10" attributes="unsigned" null="false" default="0" index="pk"/>

        <field  key="video" phptype="integer" comment="Link to video"
                dbtype="integer" precision="10" attributes="unsigned" null="false" default="0" index="pk"/>

        <field key="rank" phptype="integer" comment="Order of elements in lists"
               dbtype="integer" precision="10" null="false" default="0" index="index"/>

        <index alias="PRIMARY" name="PRIMARY" primary="true" unique="true" type="BTREE">
            <column key="course" length="" collation="A" null="false" />
            <column key="video" length="" collation="A" null="false" />
        </index>

        <index alias="rank" name="rank" primary="false" unique="false" type="BTREE">
            <column key="rank" length="" collation="A" null="false" />
        </index>

        <aggregate alias="Course" class="vcCourse" local="course" foreign="id" cardinality="one" owner="foreign" />
        <aggregate alias="Video" class="vcVideo" local="video" foreign="id" cardinality="one" owner="foreign" />

    </object>

    <object class="vcVideo" table="vc_videos" extends="xPDOSimpleObject">

        <field key="title" phptype="string" comment="Short name of video"
               dbtype="varchar" precision="255" null="false" default="" />

        <field key="alias" phptype="string" comment="Slugged title for link of video"
               dbtype="varchar" precision="255" null="false" default="" index="index" />

        <field key="description" phptype="string" comment="Description or introduction of video"
               dbtype="text"  null="true" default="" />

        <field key="cover" phptype="string" comment="Path to image, that will be used as cover"
               dbtype="varchar" precision="255" null="false" default="" />

        <field key="source" phptype="string" comment="Link to video file or embedded code for video player"
               dbtype="varchar" precision="555" null="false" default="" />

        <field key="duration" phptype="integer" comment="Duration of video (in seconds)"
               dbtype="integer" precision="3" attributes="unsigned" null="false" default="0" />

        <field key="free" phptype="boolean" comment="Status of video: free of paid"
               dbtype="tinyint" precision="1" attributes="unsigned" null="true" default="0" index="index" />

        <field key="hidden" phptype="boolean" comment="Video, that exists but hidden from lists and search"
               dbtype="tinyint" precision="1" attributes="unsigned" null="true" default="0" index="index" />

        <field key="publishedon" phptype="timestamp" comment="Date of publishing video"
               dbtype="timestamp" null="false" default="CURRENT_TIMESTAMP" index="index"/>

        <field key="collection" phptype="integer" comment="Link to collection"
               dbtype="integer" precision="10" attributes="unsigned" null="true" default="" index="index" />

        <validation>

            <rule field="source" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_videos_source_err_notEmpty"/>
            <rule field="source" name="onlyNumbers" type="preg_match" rule="/^[0-9]*$/" message="vc_videos_source_err_onlyNumbers"/>

            <rule field="title" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_videos_title_err_notEmpty"/>
            <rule field="title" name="onlyAlphaNum" type="preg_match" rule="/^[a-zA-Zа-яА-Я0-9_\-\s]*$/" message="vc_videos_title_err_onlyAlphaNum"/>

            <rule field="alias" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_videos_alias_err_notEmpty"/>
            <rule field="alias" name="onlyAlphaNum" type="preg_match" rule="/^[a-zA-Z0-9_]*$/" value="1" message="vc_videos_alias_err_notEmpty"/>

            <rule field="description" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_videos_description_err_notEmpty"/>

            <rule field="cover" name="notEmpty" type="xPDOValidationRule" rule="xPDOMinLengthValidationRule" value="1" message="vc_videos_cover_err_notEmpty"/>

        </validation>

        <index alias="alias" name="alias" primary="false" unique="false" type="BTREE">
            <column key="alias" length="" collation="A" null="false" />
        </index>

        <index alias="hidden" name="hidden" primary="false" unique="false" type="BTREE">
            <column key="hidden" length="" collation="A" null="false" />
        </index>

        <index alias="free" name="free" primary="false" unique="false" type="BTREE">
            <column key="free" length="" collation="A" null="false" />
        </index>

        <index alias="collection" name="collection" primary="false" unique="false" type="BTREE">
            <column key="collection" length="" collation="A" null="false" />
        </index>

        <aggregate alias="Collection" class="vcCollection" local="collection" foreign="id" cardinality="one" owner="foreign" />

    </object>

</model>
